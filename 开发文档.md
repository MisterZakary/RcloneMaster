#### **项目背景**
*   **名称**：RcloneMaster (v1.0)
*   **技术栈**：Go, Viper (配置), fsnotify (文件监听), Cron (调度), Windows API (MessageBox/HideWindow).
*   **核心理念**：配置解耦（环境配置与任务逻辑分离）、操作安全（杀进程+文件锁+精准校验）。

#### **当前核心逻辑 (v1.0)**
1.  **路径解析**：所有路径经过 `ExpandPath` 处理，支持 `%APPDATA%` 等 Windows 环境变量。
2.  **执行流水线**：
    *   **锁定**：在 `temp_dir` 创建 `{task_name}.lock`，防止任务重叠。
    *   **拦截**：`pre_kill` 逻辑执行“2次温柔杀+3次强制杀”，成功后延迟 1.2s 确保文件句柄释放。
    *   **执行**：调用 `rclone`，静默运行（HideWindow）。
    *   **校验**：`verify` 函数调用 `rclone size --json`。**关键点**：校验时会自动携带该文件夹对的 `includes/excludes` 过滤规则，确保大小比对的精准性。
    *   **恢复**：`post_start` 使用 `cmd /c start` 唤起 GUI 程序，脱离主进程生命周期。
3.  **交互规范**：
    *   **手动模式**：成功不弹窗（静默），失败通过 `MessageBox` 报错。
    *   **守护模式**：全静默运行，所有细节记录于按天切分的日志中。
4.  **防抖机制**：实时监控具有 8 秒防抖（Debounce），避免频繁触发同步。

#### **已知约束 & 规范**
*   **任务格式**：所有任务必须写在 `folders` 列表下，不支持旧版的单一 `source/dest` 字段。
*   **过滤优先级**：在 `runRclone` 和 `verify` 中，若 `includes` 切片不为空，则仅应用 `includes`；否则应用 `excludes`。
*   **编译要求**：必须使用 `go build -ldflags="-s -w -H windowsgui"` 以确保无窗口运行。

#### 编译命令
*   `go build -ldflags="-s -w -H windowsgui" -o rcloneMaster.exe`

#### **待优化/扩展方向**
*   [ ] 增加通知中心支持（代替 MessageBox，实现更轻量的 Windows 推送）。
*   [ ] 增加 `pre_sync_check` 逻辑，例如检查网络是否连通、目标磁盘空间是否充足。
*   [ ] 支持 Rclone 的全局 Flag 配置（如 `--bandwidth` 限制）。
*   [ ] 增加 `bisync` 模式下的冲突自动处理策略。
